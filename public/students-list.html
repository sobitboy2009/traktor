<!DOCTYPE html>
<html lang="uz">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>O'quvchilar Ro'yxati - MMM TRAKTOR SERVIS</title>

    <link href="https://fonts.googleapis.com/css?family=Open+Sans:300,400,600,700|Nunito:300,400,600,700|Poppins:300,400,500,600,700" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css" rel="stylesheet">
    <link rel="stylesheet" href="index.css">
</head>

<body>

<header id="header" class="header fixed-top d-flex align-items-center">
        <div class="d-flex align-items-center justify-content-between">
            <a href="index.html" class="logo d-flex align-items-center">
                <img src="MMM_Traktor_servis.images/logoOrg.png" alt="" >
                <span class="d-none d-lg-block" style="font-size: 21px; font-weight: 700; color: navy;">MEXANIZATORLAR MAKTABI</span>
            </a>
            <i class="bi bi-list toggle-sidebar-btn"></i>
        </div>

        <nav class="header-nav ms-auto">
            <ul class="d-flex align-items-center">
                <li class="nav-item dropdown pe-3">
                    <a class="nav-link nav-profile d-flex align-items-center pe-0" href="#" data-bs-toggle="dropdown">
                        <img src="MMM_Traktor_servis.images/Без названия.jpg" alt="Profile" class="rounded-circle">
                        <span class="d-none d-md-block dropdown-toggle ps-2">Administrator</span>
                    </a>
                    <ul class="dropdown-menu dropdown-menu-end dropdown-menu-arrow profile">
                        <li>
                            <button onclick="logout()" class="btn btn-sm btn-outline-dark m-3">
                                Tizimdan chiqish <i class="bi bi-box-arrow-right"></i>
                            </button>
                        </li>
                    </ul>
                </li>
            </ul>
        </nav>
    </header>

    <aside id="sidebar" class="sidebar" style="background-color: #cff4fc;">
        <ul class="sidebar-nav" id="sidebar-nav">
            <li class="nav-item">
                <a class="nav-link" href="index.html">
                    <i class="bi bi-grid" style="font-size: 22px;"></i>
                    <span>Bosh sahifa</span>
                </a>
            </li>
            <li class="nav-item">
                <a class="nav-link collapsed" data-bs-target="#users-nav" data-bs-toggle="collapse" href="#">
                    <i class="bi bi-people" style="font-size: 22px;"></i><span>O'quvchilar</span><i class="bi bi-chevron-down ms-auto"></i>
                </a>
                <ul id="users-nav" class="nav-content collapse show" data-bs-parent="#sidebar-nav">
                    <li>
                        <a href="students-list.html" class="active">
                            <i style="font-size: 20px;" class="bi bi-list-check"></i><span>Ro'yxatni ko'rish</span>
                        </a>
                    </li>
                    <li>
                        <a href="students-add.html">
                            <i style="font-size: 20px;" class="bi bi-plus-circle"></i><span>Yangi yaratish</span>
                        </a>
                    </li>
                </ul>
            </li>

            <li class="nav-item">
                <a class="nav-link collapsed" data-bs-target="#exams-nav" data-bs-toggle="collapse" href="#">
                    <i class="bi bi-file-earmark-pdf" style="font-size: 22px;"></i><span>Guvohnomalar</span><i class="bi bi-chevron-down ms-auto"></i>
                </a>
                <ul id="exams-nav" class="nav-content collapse" data-bs-parent="#sidebar-nav">
                    <li>
                        <a href="Guvohnomalar-list.html">
                            <i style="font-size: 20px;" class="bi bi-list-check"></i><span>Ro'yxatni ko'rish</span>
                        </a>
                    </li>
                    <li>
                        <a href="Guvohnomalar-add.html">
                            <i style="font-size: 20px;" class="bi bi-plus-circle"></i><span>Yangi yaratish</span>
                        </a>
                    </li>
                </ul>
            </li>

            <li class="nav-item">
                <a class="nav-link collapsed" data-bs-target="#invoices-nav" data-bs-toggle="collapse" href="#">
                    <i class="bi bi-cash" style="font-size: 22px;"></i><span>Invoyislar</span><i class="bi bi-chevron-down ms-auto"></i>
                </a>
                <ul id="invoices-nav" class="nav-content collapse" data-bs-parent="#sidebar-nav">
                    <li>
                        <a href="invoices-list.html">
                            <i style="font-size: 20px;" class="bi bi-list-check"></i><span>Ro'yxatni ko'rish</span>
                        </a>
                    </li>
                    <li>
                        <a href="invoices-add.html">
                            <i style="font-size: 20px;" class="bi bi-plus-circle"></i><span>Yangi yaratish</span>
                        </a>
                    </li>
                </ul>
            </li>
        </ul>
    </aside>

<main id="main" class="main">
<div class="p-4">

<h2 style="font-weight:700;color:darkblue;text-shadow:0 0 2px red;">
<i class="bi bi-people"></i> O'quvchilar Ro'yxati
</h2>

<div class="card mt-4">
<div class="card-body">

<div class="table-responsive">
<table class="table table-hover">
<thead>
<tr>
<th>#</th>
<th>JShShIR</th>
<th>To'liq Ismi</th>
<th>Tug'ilgan Sana</th>
<th>Telefon</th>
<th class="text-center">Harakatlar</th>
</tr>
</thead>

<tbody id="students-table-body">
<tr>
<td colspan="6" class="text-center py-5">
<div class="spinner-border text-primary"></div>
<p class="mt-2">Yuklanmoqda...</p>
</td>
</tr>
</tbody>

</table>
</div>

<div class="alert alert-info mt-3">
Jami: <span id="totalStudents">0</span> ta o'quvchi
</div>

</div>
</div>

</div>
</main>

<footer class="footer">
<div class="copyright">
© 2026 MMM TRAKTOR SERVIS
</div>
</footer>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>

<script>
document.addEventListener("DOMContentLoaded", loadStudents);

function loadStudents() {
    fetch("/api/students")
        .then(res => res.json())
        .then(students => {
            const tbody = document.getElementById("students-table-body");
            tbody.innerHTML = "";

            let withPhone = 0;

            students.forEach((s, index) => {
                if (s.phone) withPhone++;

                const tr = document.createElement("tr");
                tr.innerHTML = `
                    <td>${index + 1}</td>
                    <td>${s.jshshir}</td>
                    <td>${s.full_name}</td>
                    <td>${s.birth_date}</td>
                    <td>${s.phone || "-"}</td>
                    <td class="text-center">
                        <a href="students-view.html?jshshir=${s.jshshir}" class="btn btn-sm btn-primary">Ko‘rish</a>
                        <a href="students-edit.html?jshshir=${s.jshshir}" class="btn btn-sm btn-warning">Tahrirlash</a>
                        <button class="btn btn-sm btn-danger" onclick="deleteStudent('${s.jshshir}')">O‘chirish</button>
                    </td>
                `;
                tbody.appendChild(tr);
            });

            document.getElementById("totalStudents").textContent = students.length;
        })
        .catch(() => {
            alert("O'quvchilarni yuklashda xatolik");
        });
}

function deleteStudent(jshshir) {
    if (!confirm("Rostdan ham o‘chirmoqchimisiz?")) return;

    fetch(`/api/students/${jshshir}`, {
        method: "DELETE"
    }).then(() => loadStudents());
}

    document.addEventListener('DOMContentLoaded', function() {
    const toggleSidebarBtn = document.querySelector('.toggle-sidebar-btn');
    const sidebar = document.getElementById('sidebar');
    const body = document.body;
    
    if (toggleSidebarBtn && sidebar) {
        toggleSidebarBtn.addEventListener('click', function(e) {
            e.preventDefault();
            body.classList.toggle('toggle-sidebar');
            
            // Также можно добавить/удалить класс непосредственно к сайдбару
            sidebar.classList.toggle('collapsed');
            
            // Сохраняем состояние в localStorage
            if (body.classList.contains('toggle-sidebar')) {
                localStorage.setItem('sidebarCollapsed', 'true');
            } else {
                localStorage.setItem('sidebarCollapsed', 'false');
            }
        });
        
        // Восстанавливаем состояние сайдбара при загрузке
        if (localStorage.getItem('sidebarCollapsed') === 'true') {
            body.classList.add('toggle-sidebar');
            sidebar.classList.add('collapsed');
        }
    }
    
    // Добавьте также этот код для автоматического сворачивания сайдбара на мобильных устройствах
    function handleResponsiveSidebar() {
        if (window.innerWidth <= 768) {
            body.classList.add('toggle-sidebar');
            sidebar.classList.add('collapsed');
        } else {
            // На десктопе восстанавливаем сохраненное состояние
            if (localStorage.getItem('sidebarCollapsed') !== 'true') {
                body.classList.remove('toggle-sidebar');
                sidebar.classList.remove('collapsed');
            }
        }
    }
    
    
});
</script>

</body>
</html>



